<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Simple venn.js example</title>
  <style>
  body {
    font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;
    font-size: 14px;
  }
  .venntooltip {
    position: absolute;
  }

  </style>
</head>

<body>
  <div id="venn"></div>
</body>

<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="venn.js"></script>
<script>
// define sets and set set intersections
var data=[{
  station: "3FM",
  total: 1889,
  uniqueTotal: 720,
  totalMatches: 1889,
  uniqueMatches: 720,
  topMatchSongList: [],
  matchPercentage: 1,
  matchUniquePercentage: 1
},
{
  station: "538",
  total: 1987,
  uniqueTotal: 694,
  totalMatches: 1077,
  uniqueMatches: 186,
  topMatchSongList: [],
  matchPercentage: 0.24,
  matchUniquePercentage: 0.27
},
{
  station: "QMusic",
  total: 1984,
  uniqueTotal: 702,
  totalMatches: 1079,
  uniqueMatches: 193,
  topMatchSongList: [],
  matchPercentage: 0.78,
  matchUniquePercentage: 0.27
},
{
  station: "Sky Radio",
  total: 2387,
  uniqueTotal: 445,
  totalMatches: 1062,
  uniqueMatches: 107,
  topMatchSongList: [],
  matchPercentage: 0.44,
  matchUniquePercentage: 0.24
},
{
  station: "Qmusic BE",
  total: 120,
  uniqueTotal: 114,
  totalMatches: 52,
  uniqueMatches: 47,
  topMatchSongList: [],
  matchPercentage: 0.10,
  matchUniquePercentage: 0.41
}];
var sets;
function getStationsCount(data){
  var sum=0;
  var stationCount=data.length-1;
  for(var i=1;i<=stationCount;i++){
    sum+=data[i].total;
  }
  return sum;
}
function initSets(data){
  var count=getStationsCount(data);
  var stationCount=data.length-1;


  sets="[{sets:['"+data[0].station+"'], size:"+100+"},";
  for(var i=1;i<=stationCount;i++){
    var stationSize=(data[i].total/count)*100;
    var percentage=(data[i].matchPercentage*stationCount)/100;
    stationName=data[i].station;
    intersectionSize=stationSize*data[i].matchPercentage;
    sets+=("{sets:['"+stationName+"'], size:"+stationSize+", per:"+data[i].matchPercentage*100+"},");
    sets+=("{sets:['"+data[0].station+"','"+stationName+"'], size:"+intersectionSize+"},")
  }
  sets+=("]")
  console.log(eval(sets))

}
initSets(data);
var div = d3.select("#venn")
div.datum(eval(sets)).call(venn.VennDiagram());

// add a tooltip
var tooltip = d3.select("body").append("div")
.attr("class", "venntooltip");

// add listeners to all the groups to display tooltip on mouseover
div.selectAll("g")
.on("mouseover", function(d, i) {
  // sort all the areas relative to the current item
  venn.sortAreas(div, d);

  // Display a tooltip with the current size
  tooltip.transition().duration(400).style("opacity", .9);
  if(d.per!=undefined){
    tooltip.text(d.per + " %");
  }
  else{
    tooltip.text(" ")
  }
  // highlight the current path
  var selection = d3.select(this).transition("tooltip").duration(400);
  selection.select("path")
  .style("stroke-width", 3)
  .style("fill-opacity", d.sets.length == 1 ? .4 : .1)
  .style("stroke-opacity", 1);
})

.on("mousemove", function() {
  tooltip.style("left", (d3.event.pageX) + "px")
  .style("top", (d3.event.pageY - 28) + "px");
})

.on("mouseout", function(d, i) {
  tooltip.transition().duration(400).style("opacity", 0);
  var selection = d3.select(this).transition("tooltip").duration(400);
  selection.select("path")
  .style("stroke-width", 0)
  .style("fill-opacity", d.sets.length == 1 ? .25 : .0)
  .style("stroke-opacity", 0);
});
</script>
</html>
